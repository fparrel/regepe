<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Replay your GPS Tracks with REGEPE</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf8">
<link type="text/css" rel="StyleSheet" href="/static/styles/header.css" />
<link type="text/css" rel="StyleSheet" href="/static/styles/inputform.css" />
<style type="text/css">
table { border-collapse:collapse;}
</style>
</head>
<body>
    <div id="wrapper">
		<div id="header">
			<div id="header_search">
				<input name="search_req" id="search_txtbox" type="text" onkeypress="onSearchTxtboxKeypress(this,event);"/>
				<input type="button" value="Search" onclick="onSearchClick();"/>
				<div id="header_lang">
					<a href="/"><img width="16" height="11" src="/static/images/FlagEN.jpg" alt="English"/></a>
					<a href="/fr/"><img width="16" height="11" src="/static/images/FlagFR.jpg" alt="Francais"/></a>
				</div>
			</div>
			<div id="header_home">
				<a href="/"><img src="/static/images/home32x32.png" width="32" height="32" alt="Home"/>Home</a>
			</div>
			<div id="header_mobile">
				<a href="/static/mobile.html"><img src="/static/images/android32x32.png" width="32" height="32" alt="Get app"/>Get app</a>
			</div>
			<div id="header_submit">
				<a href="/submitform"><img src="/static/images/Up32x32.png" width="32" height="32" alt="Submit"/>Submit track</a>
			</div>
			<div id="header_prepare">
				<a href="/prepare"><img src="/static/images/map_edit.png" width="32" height="32" alt="Prepare"/>Prepare itinerary</a>
			</div>
			<div id="header_mapofmaps">
				<a href="mapofmaps.html"><img src="/static/images/WorldSearch32x32.png" width="32" height="32" alt="Browse"/>Browse tracks</a>
			</div>
			<div id="header_login">
				<form action="">
					<div>User: <input id="login_user" name="user" type="text" onkeypress="onUserTxtboxKeypress(this,event);"/>
					Password: <input id="login_password" name="password" type="password" onkeypress="onPwdTxtboxKeypress(this,event);"/>
					<input type="button" value="Login" onclick="onLoginClick();"/><br/>
					<a href="/registerform">Register</a> |
					<a href="/static/forgotpwd.html">Forgot password?</a>
					</div>
				</form>
			</div>
		</div>
		<div id="body">
			<h1>User {{ user }}</h1>
			<h2>My tracks</h2>
			Selection: <input type="button" value="Delete" onclick="onDeleteClick();"/> <input type="button" value="Merge" onclick="onMergeClick();"/><br/>
			<div style="width:50%; overflow:auto; position: absolute; height: 100%;">
				<table><thead></thead><tbody>
{% for map in maps %}
	<tr id="row{{ map.mapid }}" style="cursor:pointer;" onclick="changePreview('{{ map.mapid }}',{{ map.lat }},{{ map.lon }},'{{ map.desc }}')"><td><input class="chkbx" type="checkbox" name="chkbx{{ map.mapid }}"/></td><td>{{ map.date }}</td><td>{{ map.desc }}</td><td style="font-size:10px;"><a href="/showmap/{{ map.mapid }}">View</a></tr>
{% endfor %}
				</tbody></table>
			</div>
			<div id="previewout" style="position: absolute; margin-left: 50%; heigth:110px;width:130px;"><img style="visibility:hidden;" width="130" height="110" name="preview" id="preview"></div>
			<div id="map_of_maps" style="height:300px;width:400px;right:0; position: absolute; margin-right: 10px;"></div>
			<div id="footer_push"></div>
	</div>
	<div id="footer">
		<b>Contact:</b> <a href="mailto:info@regepe.com">info@regepe.com</a>
	</div>
</div>
</body>
</html>
<script type="text/javascript" src="/static/javascript/xmlhttprequest.js"></script>
<script type="text/javascript" src="/static/javascript/header.js"></script>
<script type="text/javascript" src="/static/javascript/db.js"></script>
<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key={{ GMapsApiKey2 }}" type="text/javascript"></script>
<script type="text/javascript" src="/static/javascript/preview.js"></script>
<script type="text/javascript">
//<![CDATA[

function getMapList() {
    var eles = document.getElementsByClassName("chkbx");
    var mapidlist = "";
    for(var i=0;i<eles.length;i++) {
        if(eles[i].checked) {
            if(mapidlist.length>0)
                mapidlist += "," + eles[i].name.substring(5);
            else
                mapidlist += eles[i].name.substring(5);
        }
    }
    return mapidlist;
}

function onMergeClick() {
    var mapidlist = getMapList();
    var user_sess = getSessionFromCookie();
    var url = '/mergemaps/'+ mapidlist + '/' + user_sess[0] + '/' + user_sess[1];
    document.location.href = url;
}

function onDeleteClick() {
    var mapidlist = getMapList();
    var user_sess = getSessionFromCookie();
    var url = '/delmaps/'+ mapidlist + '/' + user_sess[0] + '/' + user_sess[1];
    if (confirm("Confirm deletion of "+(mapidlist.split(",").length)+" map(s)?")) { 
        document.location.href = url;
    }
}

//]]>
</script>
